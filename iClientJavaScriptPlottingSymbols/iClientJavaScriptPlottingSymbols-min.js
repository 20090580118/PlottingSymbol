SuperMap.Geometry.GeoPlotting=SuperMap.Class(SuperMap.Geometry.Polygon,{_controlPoints:[],initialize:function(a){SuperMap.Geometry.Polygon.prototype.initialize.apply(this,arguments);this._controlPoints=a;if(a&&a.length>0){this.calculateParts()}},getControlPoints:function(){return this._controlPoints},setControlPoint:function(a){if(a&&a.length&&a.length>0){this._controlPoints=a;this.calculateParts()}},clone:function(){var d=new SuperMap.Geometry.GeoPlotting();var b=[];for(var c=0,a=this._controlPoints.length;c<a;c++){b.push(this._controlPoints[c].clone())}d._controlPoints=b;return d},toJSON:function(){if(!this._controlPoints){return null}var b=this._controlPoints.length;var a=[];for(var c=0;c<b;c++){a.push(this.controlPointToJSON(this._controlPoints[c]))}return'{"controlPoints":['+a.join(",")+"]}"},calculateParts:function(){},calculateVector:function(q,p,k){if(!p){p=Math.PI/2}if(!k){k=1}var t;var r;var f;var e;var s;var j;var i=Math.sqrt(q.x*q.x+q.y*q.y);if(q.y==0){t=r=i*k*Math.cos(p)/q.x;if(q.x>0){f=Math.sqrt(k*k-t*t);e=-f}else{if(q.x<0){e=Math.sqrt(k*k-t*t);f=-e}}s=new SuperMap.Geometry.Point(t,f);j=new SuperMap.Geometry.Point(r,e)}else{var g=-q.x/q.y;var h=k*i*Math.cos(p)/q.y;var p=1+g*g;var o=2*g*h;var l=h*h-k*k;t=(-o-Math.sqrt(o*o-4*p*l))/(2*p);r=(-o+Math.sqrt(o*o-4*p*l))/(2*p);f=g*t+h;e=g*r+h;if(q.y>=0){s=new SuperMap.Geometry.Point(t,f);j=new SuperMap.Geometry.Point(r,e)}else{if(q.y<0){s=new SuperMap.Geometry.Point(r,e);j=new SuperMap.Geometry.Point(t,f)}}}return[s,j]},calculateIntersection:function(e,d,c,b){var a;var f;if(e.y*d.x-e.x*d.y==0){if(e.x*d.x>0||e.y*d.y>0){a=(c.x+b.x)/2;f=(c.y+b.y)/2}else{a=b.x;f=b.y}}else{a=(e.x*d.x*(b.y-c.y)+c.x*e.y*d.x-b.x*d.y*e.x)/(e.y*d.x-e.x*d.y);if(e.x!=0){f=(a-c.x)*e.y/e.x+c.y}else{f=(a-b.x)*d.y/d.x+b.y}}return new SuperMap.Geometry.Point(a,f)},calculateAngularBisector:function(d,c){var b=Math.sqrt(d.x*d.x+d.y*d.y);var a=Math.sqrt(c.x*c.x+c.y*c.y);return new SuperMap.Geometry.Point(d.x/b+c.x/a,d.y/b+c.y/a)},calculateIntersectionFromTwoCorner:function(e,l,i,b){if(!i){i=Math.PI/4}if(!b){b=Math.PI/4}var m=new SuperMap.Geometry.Point(l.x-e.x,l.y-e.y);var c=this.calculateVector(m,i,1);var g=c[0];var d=c[1];var f=this.calculateVector(m,Math.PI-i,1);var a=f[0];var k=f[1];var j=this.calculateIntersection(g,a,e,l);var h=this.calculateIntersection(d,k,e,l);return[j,h]},cloneControlPoints:function(c){var a=[];for(var b=0;b<c.length;b++){a.push(c[b].clone())}return a},controlPointToJSON:function(a){return'{"x":  '+a.x+', "y": '+a.y+"}"},CLASS_NAME:"SuperMap.Geometry.GeoPlotting"});SuperMap.Geometry.GeoPlotting.getControlPointsFromJSON=function(str){var cps=[];var r=/{.*?}/g;var arr=str.match(r);for(var i=0,len=arr.length;i<len;i++){var point=eval("("+arr[i]+")");cps.push(new SuperMap.Geometry.Point(point.x,point.y))}return cps};SuperMap.Geometry.GeoCircle=SuperMap.Class(SuperMap.Geometry.GeoPlotting,{initialize:function(a){SuperMap.Geometry.GeoPlotting.prototype.initialize.apply(this,arguments)},toJSON:function(){return SuperMap.Geometry.GeoPlotting.prototype.toJSON.apply(this,arguments)},clone:function(){var c=new SuperMap.Geometry.GeoCircle();var b=[];for(var d=0,a=this._controlPoints.length;d<a;d++){b.push(this._controlPoints[d].clone())}c._controlPoints=b;return c},calculateParts:function(){this.components=[];if(this._controlPoints.length>1){var g=this._controlPoints[0];var b=this._controlPoints[this._controlPoints.length-1];var e=[];var a=Math.sqrt((b.x-g.x)*(b.x-g.x)+(b.y-g.y)*(b.y-g.y));for(var c=0;c<360;c++){var f=(c+1)*Math.PI/180;var d=new SuperMap.Geometry.Point(Math.cos(f)*a+g.x,Math.sin(f)*a+g.y);e[c]=d}this.components.push(new SuperMap.Geometry.LinearRing(e))}},CLASS_NAME:"SuperMap.Geometry.GeoCircle"});SuperMap.Geometry.GeoCircle.fromJSON=function(d){var b=new SuperMap.Geometry.GeoCircle();var c=d.match(/"controlPoints":(\[.*?\])/)[1];var a=SuperMap.Geometry.GeoPlotting.getControlPointsFromJSON(c);b._controlPoints=a;return b};SuperMap.Geometry.GeoCurveFlag=SuperMap.Class(SuperMap.Geometry.GeoPlotting,{initialize:function(a){SuperMap.Geometry.GeoPlotting.prototype.initialize.apply(this,arguments)},toJSON:function(){return SuperMap.Geometry.GeoPlotting.prototype.toJSON.apply(this,arguments)},clone:function(){var d=new SuperMap.Geometry.GeoCurveFlag();var b=[];for(var c=0,a=this._controlPoints.length;c<a;c++){b.push(this._controlPoints[c].clone())}d._controlPoints=b;return d},calculateParts:function(){var l=this.cloneControlPoints(this._controlPoints);this.components=[];if(l.length>1){var a=l[0];var k=l[l.length-1];var j=a;var i=new SuperMap.Geometry.Point((k.x-a.x)/4+a.x,(k.y-a.y)/8+a.y);var h=new SuperMap.Geometry.Point((a.x+k.x)/2,a.y);var g=new SuperMap.Geometry.Point((k.x-a.x)*3/4+a.x,-(k.y-a.y)/8+a.y);var f=new SuperMap.Geometry.Point(k.x,a.y);var e=new SuperMap.Geometry.Point(k.x,(a.y+k.y)/2);var d=new SuperMap.Geometry.Point((k.x-a.x)*3/4+a.x,(k.y-a.y)*3/8+a.y);var c=new SuperMap.Geometry.Point((a.x+k.x)/2,(a.y+k.y)/2);var b=new SuperMap.Geometry.Point((k.x-a.x)/4+a.x,(k.y-a.y)*5/8+a.y);var q=new SuperMap.Geometry.Point(a.x,(a.y+k.y)/2);var p=new SuperMap.Geometry.Point(a.x,k.y);var o=SuperMap.Geometry.LineString.createBezier2([j,i,h,g,f]).components;var m=SuperMap.Geometry.LineString.createBezier2([e,d,c,b,q]).components;var n=o.concat(m);n.push(p);this.components.push(new SuperMap.Geometry.LinearRing(n))}},CLASS_NAME:"SuperMap.Geometry.GeoCurveFlag"});SuperMap.Geometry.GeoCurveFlag.fromJSON=function(d){var c=new SuperMap.Geometry.GeoCurveFlag();var b=d.match(/"controlPoints":(\[.*?\])/)[1];var a=SuperMap.Geometry.GeoPlotting.getControlPointsFromJSON(b);c._controlPoints=a;return c};SuperMap.Geometry.GeoDiagonalArrow=SuperMap.Class(SuperMap.Geometry.GeoPlotting,{_ratio:6,initialize:function(a){SuperMap.Geometry.GeoPlotting.prototype.initialize.apply(this,arguments)},getRatio:function(){return this._ratio},setRatio:function(a){if(a){this._ratio=a;this.calculateParts()}},toJSON:function(){if(!this._controlPoints){return null}var c;var b=this._controlPoints.length;var a=[];for(var d=0;d<b;d++){a.push(this.controlPointToJSON(this._controlPoints[d]))}c='{"controlPoints":['+a.join(",")+'],"ratio":'+this._ratio+"}";return c},clone:function(){var c=new SuperMap.Geometry.GeoDiagonalArrow();var b=[];for(var d=0,a=this._controlPoints.length;d<a;d++){b.push(this._controlPoints[d].clone())}c._ratio=this._ratio;c._controlPoints=b;return c},calculateParts:function(){if(this._controlPoints==null||this._controlPoints.length<2){return}if(this._controlPoints.length==2&&(this._controlPoints[0]).equals(this._controlPoints[1])){return}this.components=[];if(this._controlPoints.length==2){this.calculateTwoPoints()}else{this.calculateMorePoints()}},calculateTwoPoints:function(){var o=this.cloneControlPoints(this._controlPoints);var f=o[0];var q=o[1];var h=Math.sqrt((q.y-f.y)*(q.y-f.y)+(q.x-f.x)*(q.x-f.x));var p=h/this._ratio;var c=f.x+(q.x-f.x)*(this._ratio-1)/this._ratio;var n=f.y+(q.y-f.y)*(this._ratio-1)/this._ratio;var g=new SuperMap.Geometry.Point(c,n);var m=this.calculateVector(new SuperMap.Geometry.Point(q.x-f.x,q.y-f.y),Math.PI/2,p/2);var e=m[0];var a=m[1];var j=new SuperMap.Geometry.Point(e.x+f.x,e.y+f.y);var b=new SuperMap.Geometry.Point(a.x+f.x,a.y+f.y);var d=new SuperMap.Geometry.Point(e.x/this._ratio+c,e.y/this._ratio+n);var r=new SuperMap.Geometry.Point(a.x/this._ratio+c,a.y/this._ratio+n);var k=new SuperMap.Geometry.Point(d.x*2-r.x,d.y*2-r.y);var i=new SuperMap.Geometry.Point(r.x*2-d.x,r.y*2-d.y);this.components.push(new SuperMap.Geometry.LinearRing([j,d,k,q,i,r,b]))},calculateMorePoints:function(){var O=this.cloneControlPoints(this._controlPoints);var Q=0;var N=0;for(var U=0;U<O.length-1;U++){var e=O[U];var q=O[U+1];Q+=Math.sqrt((q.y-e.y)*(q.y-e.y)+(q.x-e.x)*(q.x-e.x))}N=Q/this._ratio;var aa=Math.atan(N/(2*Q));var F=[];var C=[];var g=new SuperMap.Geometry.Point();var d=new SuperMap.Geometry.Point();for(var T=0;T<O.length-2;T++){var A=O[T];var y=O[T+1];var x=O[T+2];var S=new SuperMap.Geometry.Point(y.x-A.x,y.y-A.y);var M=new SuperMap.Geometry.Point(x.x-y.x,x.y-y.y);var K=new SuperMap.Geometry.Point();var Y=new SuperMap.Geometry.Point();if(T==0){var ab=this.calculateVector(S,Math.PI/2,N/2);var o=ab[0];var s=ab[1];g=K=new SuperMap.Geometry.Point(o.x+A.x,o.y+A.y);d=Y=new SuperMap.Geometry.Point(s.x+A.x,s.y+A.y)}else{K=F[F.length-1];Y=C[C.length-1]}var ac=this.calculateVector(S,aa,1);var p=ac[1];var h=ac[0];var V=this.calculateAngularBisector(new SuperMap.Geometry.Point(-S.x,-S.y),M);var J=this.calculateIntersection(p,V,K,y);var X=this.calculateIntersection(h,V,Y,y);F.push(new SuperMap.Geometry.Point((K.x+J.x)/2,(K.y+J.y)/2));F.push(J);C.push(new SuperMap.Geometry.Point((Y.x+X.x)/2,(Y.y+X.y)/2));C.push(X)}var G=O[O.length-2];var I=O[O.length-1];var r=Math.sqrt((G.x-I.x)*(G.x-I.x)+(G.y-I.y)*(G.y-I.y));var E=new SuperMap.Geometry.Point();var B=new SuperMap.Geometry.Point();var P=[];var L=new SuperMap.Geometry.Point();var c=new SuperMap.Geometry.Point();var z=new SuperMap.Geometry.Point();var v=new SuperMap.Geometry.Point();var H=F[F.length-1];var b=C[C.length-1];var Z=new SuperMap.Geometry.Point();var t=new SuperMap.Geometry.Point();if(r<=N){P=this.calculateVector(new SuperMap.Geometry.Point(I.x-G.x,I.y-G.y),Math.PI/2,N/2);Z=P[0];t=P[1];E=new SuperMap.Geometry.Point(Z.x/this._ratio+G.x,Z.y/this._ratio+G.y);B=new SuperMap.Geometry.Point(t.x/this._ratio+G.x,t.y/this._ratio+G.y);z=new SuperMap.Geometry.Point(E.x*2-B.x,E.y*2-B.y);v=new SuperMap.Geometry.Point(B.x*2-E.x,B.y*2-E.y);L=new SuperMap.Geometry.Point((H.x+E.x)/2,(H.y+E.y)/2);c=new SuperMap.Geometry.Point((b.x+B.x)/2,(b.y+B.y)/2);F.push(L);C.push(c)}else{var W=new SuperMap.Geometry.Point(I.x-G.x,I.y-G.y);var u=Math.sqrt(W.x*W.x+W.y*W.y);var D=new SuperMap.Geometry.Point(I.x-W.x*N/u,I.y-W.y*N/u);P=this.calculateVector(new SuperMap.Geometry.Point(I.x-D.x,I.y-D.y),Math.PI/2,N/2);Z=P[0];t=P[1];E=new SuperMap.Geometry.Point(Z.x/this._ratio+D.x,Z.y/this._ratio+D.y);B=new SuperMap.Geometry.Point(t.x/this._ratio+D.x,t.y/this._ratio+D.y);z=new SuperMap.Geometry.Point(E.x*2-B.x,E.y*2-B.y);v=new SuperMap.Geometry.Point(B.x*2-E.x,B.y*2-E.y);L=new SuperMap.Geometry.Point((H.x+E.x)/2,(H.y+E.y)/2);c=new SuperMap.Geometry.Point((b.x+B.x)/2,(b.y+B.y)/2);F.push(L);C.push(c)}var m=SuperMap.Geometry.LineString.createBezier2(F).components;var f=SuperMap.Geometry.LineString.createBezier2(C).components;var n=[g];n=n.concat(m);n.push(E);n.push(z);n.push(I);n.push(v);n.push(B);for(var R=f.length-1;R>=0;R--){n.push(f[R])}n.push(d);this.components.push(new SuperMap.Geometry.LinearRing(n))},CLASS_NAME:"SuperMap.Geometry.GeoDiagonalArrow"});SuperMap.Geometry.GeoDiagonalArrow.fromJSON=function(e){var b=new SuperMap.Geometry.GeoDiagonalArrow();var d=e.match(/"ratio":([0-9]+)/)[1];b._ratio=parseInt(d);var c=e.match(/"controlPoints":(\[.*?\])/)[1];var a=SuperMap.Geometry.GeoPlotting.getControlPointsFromJSON(c);b._controlPoints=a;return b};SuperMap.Geometry.GeoDoveTailDiagonalArrow=SuperMap.Class(SuperMap.Geometry.GeoPlotting,{_ratio:6,_tailRatio:5,initialize:function(a){SuperMap.Geometry.GeoPlotting.prototype.initialize.apply(this,arguments)},getRatio:function(){return this._ratio},setRatio:function(a){if(a){this._ratio=a;this.calculateParts()}},toJSON:function(){if(!this._controlPoints){return null}var c;var b=this._controlPoints.length;var a=[];for(var d=0;d<b;d++){a.push(this.controlPointToJSON(this._controlPoints[d]))}c='{"controlPoints":['+a.join(",")+'],"ratio":'+this._ratio+"}";return c},clone:function(){var d=new SuperMap.Geometry.GeoDoveTailDiagonalArrow();var b=[];for(var c=0,a=this._controlPoints.length;c<a;c++){b.push(this._controlPoints[c].clone())}d._ratio=this._ratio;d._controlPoints=b;return d},calculateParts:function(){if(this._controlPoints==null||this._controlPoints.length<2){return}if(this._controlPoints.length==2&&(this._controlPoints[0]).equals(this._controlPoints[1])){return}this.components=[];if(this._controlPoints.length==2){this.calculateTwoPoints()}else{this.calculateMorePoints()}},calculateTwoPoints:function(){var f=this.cloneControlPoints(this._controlPoints);var h=f[0];var o=f[1];var m=Math.sqrt((o.y-h.y)*(o.y-h.y)+(o.x-h.x)*(o.x-h.x));var i=m/this._ratio;var q=h.x+(o.x-h.x)*(this._ratio-1)/this._ratio;var a=h.y+(o.y-h.y)*(this._ratio-1)/this._ratio;var n=new SuperMap.Geometry.Point(q,a);var j=this.calculateVector(new SuperMap.Geometry.Point(o.x-h.x,o.y-h.y),Math.PI/2,i/2);var r=j[0];var s=j[1];var p=new SuperMap.Geometry.Point(r.x+h.x,r.y+h.y);var k=new SuperMap.Geometry.Point(s.x+h.x,s.y+h.y);var c=new SuperMap.Geometry.Point((o.x-h.x)/this._tailRatio+h.x,(o.y-h.y)/this._tailRatio+h.y);var e=new SuperMap.Geometry.Point(r.x/this._ratio+q,r.y/this._ratio+a);var b=new SuperMap.Geometry.Point(s.x/this._ratio+q,s.y/this._ratio+a);var g=new SuperMap.Geometry.Point(e.x*2-b.x,e.y*2-b.y);var d=new SuperMap.Geometry.Point(b.x*2-e.x,b.y*2-e.y);this.components.push(new SuperMap.Geometry.LinearRing([c,p,e,g,o,d,b,k]))},calculateMorePoints:function(){var O=this.cloneControlPoints(this._controlPoints);var Q=0;var N=0;var V;for(var U=0;U<O.length-1;U++){var e=O[U];var q=O[U+1];Q+=Math.sqrt((q.y-e.y)*(q.y-e.y)+(q.x-e.x)*(q.x-e.x));if(U==0){V=new SuperMap.Geometry.Point((q.x-e.x)/this._tailRatio+e.x,(q.y-e.y)/this._tailRatio+e.y)}}N=Q/this._ratio;var ab=Math.atan(N/(2*Q));var F=[];var C=[];var g=new SuperMap.Geometry.Point();var d=new SuperMap.Geometry.Point();for(var T=0;T<O.length-2;T++){var A=O[T];var y=O[T+1];var x=O[T+2];var S=new SuperMap.Geometry.Point(y.x-A.x,y.y-A.y);var M=new SuperMap.Geometry.Point(x.x-y.x,x.y-y.y);var K=new SuperMap.Geometry.Point();var Z=new SuperMap.Geometry.Point();if(T==0){var ac=this.calculateVector(S,Math.PI/2,N/2);var o=ac[0];var s=ac[1];g=K=new SuperMap.Geometry.Point(o.x+A.x,o.y+A.y);d=Z=new SuperMap.Geometry.Point(s.x+A.x,s.y+A.y)}else{K=F[F.length-1];Z=C[C.length-1]}var ad=this.calculateVector(S,ab,1);var p=ad[1];var h=ad[0];var W=this.calculateAngularBisector(new SuperMap.Geometry.Point(-S.x,-S.y),M);var J=this.calculateIntersection(p,W,K,y);var Y=this.calculateIntersection(h,W,Z,y);F.push(new SuperMap.Geometry.Point((K.x+J.x)/2,(K.y+J.y)/2));F.push(J);C.push(new SuperMap.Geometry.Point((Z.x+Y.x)/2,(Z.y+Y.y)/2));C.push(Y)}var G=O[O.length-2];var I=O[O.length-1];var r=Math.sqrt((G.x-I.x)*(G.x-I.x)+(G.y-I.y)*(G.y-I.y));var E=new SuperMap.Geometry.Point();var B=new SuperMap.Geometry.Point();var P=[];var L=new SuperMap.Geometry.Point();var c=new SuperMap.Geometry.Point();var z=new SuperMap.Geometry.Point();var v=new SuperMap.Geometry.Point();var H=F[F.length-1];var b=C[C.length-1];var aa=new SuperMap.Geometry.Point();var t=new SuperMap.Geometry.Point();if(r<=N){P=this.calculateVector(new SuperMap.Geometry.Point(I.x-G.x,I.y-G.y),Math.PI/2,N/2);aa=P[0];t=P[1];E=new SuperMap.Geometry.Point(aa.x/this._ratio+G.x,aa.y/this._ratio+G.y);B=new SuperMap.Geometry.Point(t.x/this._ratio+G.x,t.y/this._ratio+G.y);z=new SuperMap.Geometry.Point(E.x*2-B.x,E.y*2-B.y);v=new SuperMap.Geometry.Point(B.x*2-E.x,B.y*2-E.y);L=new SuperMap.Geometry.Point((H.x+E.x)/2,(H.y+E.y)/2);c=new SuperMap.Geometry.Point((b.x+B.x)/2,(b.y+B.y)/2);F.push(L);C.push(c)}else{var X=new SuperMap.Geometry.Point(I.x-G.x,I.y-G.y);var u=Math.sqrt(X.x*X.x+X.y*X.y);var D=new SuperMap.Geometry.Point(I.x-X.x*N/u,I.y-X.y*N/u);P=this.calculateVector(new SuperMap.Geometry.Point(I.x-D.x,I.y-D.y),Math.PI/2,N/2);aa=P[0];t=P[1];E=new SuperMap.Geometry.Point(aa.x/this._ratio+D.x,aa.y/this._ratio+D.y);B=new SuperMap.Geometry.Point(t.x/this._ratio+D.x,t.y/this._ratio+D.y);z=new SuperMap.Geometry.Point(E.x*2-B.x,E.y*2-B.y);v=new SuperMap.Geometry.Point(B.x*2-E.x,B.y*2-E.y);L=new SuperMap.Geometry.Point((H.x+E.x)/2,(H.y+E.y)/2);c=new SuperMap.Geometry.Point((b.x+B.x)/2,(b.y+B.y)/2);F.push(L);C.push(c)}var m=SuperMap.Geometry.LineString.createBezier2(F).components;var f=SuperMap.Geometry.LineString.createBezier2(C).components;var n=[g];n=n.concat(m);n.push(E);n.push(z);n.push(I);n.push(v);n.push(B);for(var R=f.length-1;R>=0;R--){n.push(f[R])}n.push(d);n.push(V);this.components.push(new SuperMap.Geometry.LinearRing(n))},CLASS_NAME:"SuperMap.Geometry.GeoDoveTailDiagonalArrow"});SuperMap.Geometry.GeoDoveTailDiagonalArrow.fromJSON=function(e){var d=new SuperMap.Geometry.GeoDoveTailDiagonalArrow();var c=e.match(/"ratio":([0-9]+)/)[1];d._ratio=parseInt(c);var b=e.match(/"controlPoints":(\[.*?\])/)[1];var a=SuperMap.Geometry.GeoPlotting.getControlPointsFromJSON(b);d._controlPoints=a;return d};SuperMap.Geometry.GeoDoubleArrow=SuperMap.Class(SuperMap.Geometry.GeoPlotting,{initialize:function(a){SuperMap.Geometry.GeoPlotting.prototype.initialize.apply(this,arguments)},toJSON:function(){return SuperMap.Geometry.GeoPlotting.prototype.toJSON.apply(this,arguments)},clone:function(){var b=new SuperMap.Geometry.GeoDoubleArrow();var c=[];for(var d=0,a=this._controlPoints.length;d<a;d++){c.push(this._controlPoints[d].clone())}b._controlPoints=c;return b},calculateParts:function(){if(this._controlPoints==null||this._controlPoints.length<4){return}var L=this.cloneControlPoints(this._controlPoints);var y=L[0];var v=L[1];var s=L[2];var r=L[3];var i=new SuperMap.Geometry.Point(((y.x+v.x)*5+(s.x+r.x))/12,((y.y+v.y)*5+(s.y+r.y))/12);var U=this.calculateIntersectionFromTwoCorner(y,r,Math.PI/8,Math.PI/6)[0];var W=this.calculateIntersectionFromTwoCorner(i,r,Math.PI/8,Math.PI/16)[0];var l=this.calculateIntersectionFromTwoCorner(v,s,Math.PI/8,Math.PI/6)[1];var a=this.calculateIntersectionFromTwoCorner(i,s,Math.PI/8,Math.PI/16)[1];var D=new SuperMap.Geometry.Point(U.x-r.x,U.y-r.y);var B=Math.sqrt(D.x*D.x+D.y*D.y);var I=new SuperMap.Geometry.Point(D.x/B,D.y/B);var E=new SuperMap.Geometry.Point(W.x-r.x,W.y-r.y);var P=Math.sqrt(E.x*E.x+E.y*E.y);var t=new SuperMap.Geometry.Point(E.x/P,E.y/P);var n=0.25;var d=B<P?B*n:P*n;var f=new SuperMap.Geometry.Point(I.x*d+r.x,I.y*d+r.y);var M=new SuperMap.Geometry.Point(t.x*d+r.x,t.y*d+r.y);var O=new SuperMap.Geometry.Point(f.x*1.5-M.x*0.5,f.y*1.5-M.y*0.5);var K=new SuperMap.Geometry.Point(M.x*1.5-f.x*0.5,M.y*1.5-f.y*0.5);var Q=new SuperMap.Geometry.Point(l.x-s.x,l.y-s.y);var N=Math.sqrt(Q.x*Q.x+Q.y*Q.y);var J=new SuperMap.Geometry.Point(Q.x/N,Q.y/N);var F=new SuperMap.Geometry.Point(a.x-s.x,a.y-s.y);var R=Math.sqrt(F.x*F.x+F.y*F.y);var T=new SuperMap.Geometry.Point(F.x/R,F.y/R);var z=N<R?N*n:R*n;var h=new SuperMap.Geometry.Point(J.x*z+s.x,J.y*z+s.y);var p=new SuperMap.Geometry.Point(T.x*z+s.x,T.y*z+s.y);var e=new SuperMap.Geometry.Point(h.x*1.5-p.x*0.5,h.y*1.5-p.y*0.5);var g=new SuperMap.Geometry.Point(p.x*1.5-h.x*0.5,p.y*1.5-h.y*0.5);var m=SuperMap.Geometry.LineString.createBezier2([y,U,f]).components;var C=new SuperMap.Geometry.Point(s.x-r.x,s.y-r.y);var o=new SuperMap.Geometry.Point(i.x-r.x,i.y-r.y);var k=Math.sqrt(o.x*o.x+o.y*o.y);var A=new SuperMap.Geometry.Point(i.x-s.x,i.y-s.y);var x=Math.sqrt(A.x*A.x+A.y*A.y);var b=0.4;var c=new SuperMap.Geometry.Point(C.x*b,C.y*b);var H=new SuperMap.Geometry.Point(c.x*k/(k+x),c.y*k/(k+x));var G=new SuperMap.Geometry.Point(c.x*x/(k+x),c.y*x/(k+x));var V=new SuperMap.Geometry.Point(i.x-H.x,i.y-H.y);var S=new SuperMap.Geometry.Point(i.x+G.x,i.y+G.y);var q=[M,W,V,i,S,a,p];var w=SuperMap.Geometry.LineString.createBezier1(q,0,20).components;var j=SuperMap.Geometry.LineString.createBezier2([h,l,v]).components;var u=m;u.push(O);u.push(r);u.push(K);u=u.concat(w);u.push(g);u.push(s);u.push(e);u=u.concat(j);this.components=[];this.components.push(new SuperMap.Geometry.LinearRing(u))},CLASS_NAME:"SuperMap.Geometry.GeoDoubleArrow"});SuperMap.Geometry.GeoDoubleArrow.fromJSON=function(d){var b=new SuperMap.Geometry.GeoDoubleArrow();var c=d.match(/"controlPoints":(\[.*?\])/)[1];var a=SuperMap.Geometry.GeoPlotting.getControlPointsFromJSON(c);b._controlPoints=a;return b};SuperMap.Geometry.GeoRectFlag=SuperMap.Class(SuperMap.Geometry.GeoPlotting,{initialize:function(a){SuperMap.Geometry.GeoPlotting.prototype.initialize.apply(this,arguments)},toJSON:function(){return SuperMap.Geometry.GeoPlotting.prototype.toJSON.apply(this,arguments)},clone:function(){var b=new SuperMap.Geometry.GeoRectFlag();var c=[];for(var d=0,a=this._controlPoints.length;d<a;d++){c.push(this._controlPoints[d].clone())}b._controlPoints=c;return b},calculateParts:function(){this.components=[];if(this._controlPoints.length>1){var g=this._controlPoints[0];var e=this._controlPoints[this._controlPoints.length-1];var f=g.clone();var d=new SuperMap.Geometry.Point(e.x,g.y);var c=new SuperMap.Geometry.Point(e.x,(g.y+e.y)/2);var b=new SuperMap.Geometry.Point(g.x,(g.y+e.y)/2);var a=new SuperMap.Geometry.Point(g.x,e.y);this.components.push(new SuperMap.Geometry.LinearRing([f,d,c,b,a]))}},CLASS_NAME:"SuperMap.Geometry.GeoRectFlag"});SuperMap.Geometry.GeoRectFlag.fromJSON=function(d){var b=new SuperMap.Geometry.GeoRectFlag();var c=d.match(/"controlPoints":(\[.*?\])/)[1];var a=SuperMap.Geometry.GeoPlotting.getControlPointsFromJSON(c);b._controlPoints=a;return b};SuperMap.Geometry.GeoStraightArrow=SuperMap.Class(SuperMap.Geometry.GeoPlotting,{_ratio:6,initialize:function(a){SuperMap.Geometry.GeoPlotting.prototype.initialize.apply(this,arguments)},getRatio:function(){return this._ratio},setRatio:function(a){if(a){this._ratio=a;this.calculateParts()}},clone:function(){var d=new SuperMap.Geometry.GeoStraightArrow();var b=[];for(var c=0,a=this._controlPoints.length;c<a;c++){b.push(this._controlPoints[c].clone())}d._ratio=this._ratio;d._controlPoints=b;return d},toJSON:function(){if(!this._controlPoints){return null}var c;var b=this._controlPoints.length;var a=[];for(var d=0;d<b;d++){a.push(this.controlPointToJSON(this._controlPoints[d]))}c='{"controlPoints":['+a.join(",")+'],"ratio":'+this._ratio+"}";return c},calculateParts:function(){if(this._controlPoints==null||this._controlPoints.length<2){return}if(this._controlPoints.length==2&&(this._controlPoints[0]).equals(this._controlPoints[1])){return}this.components=[];if(this._controlPoints.length==2){this.calculateTwoPoints()}else{this.calculateMorePoints()}},calculateTwoPoints:function(){var o=this.cloneControlPoints(this._controlPoints);var b=o[0];var q=o[1];var c=Math.sqrt((q.y-b.y)*(q.y-b.y)+(q.x-b.x)*(q.x-b.x));var p=c/this._ratio;var a=b.x+(q.x-b.x)*(this._ratio-1)/this._ratio;var n=b.y+(q.y-b.y)*(this._ratio-1)/this._ratio;var d=this.calculateVector(new SuperMap.Geometry.Point(q.x-b.x,q.y-b.y),Math.PI/2,p/2);var r=d[0];var j=d[1];var m=new SuperMap.Geometry.Point(b.x+r.x,b.y+r.y);var k=new SuperMap.Geometry.Point(a+m.x-b.x,n+m.y-b.y);var i=new SuperMap.Geometry.Point(2*k.x-a,2*k.y-n);var h=new SuperMap.Geometry.Point(q.x,q.y);var e=new SuperMap.Geometry.Point(b.x+j.x,b.y+j.y);var f=new SuperMap.Geometry.Point(a+e.x-b.x,n+e.y-b.y);var g=new SuperMap.Geometry.Point(2*f.x-a,2*f.y-n);this.components.push(new SuperMap.Geometry.LinearRing([m,k,i,h,g,f,e]))},calculateMorePoints:function(){var R=this.cloneControlPoints(this._controlPoints);var V=0;var Q=0;for(var Y=0;Y<R.length-1;Y++){var e=R[Y];var n=R[Y+1];V+=Math.sqrt((n.y-e.y)*(n.y-e.y)+(n.x-e.x)*(n.x-e.x))}Q=V/this._ratio;var C=[];var z=[];var h=SuperMap.Geometry.Point();var c=SuperMap.Geometry.Point();for(var X=0;X<R.length-2;X++){var u=R[X];var s=R[X+1];var r=R[X+2];var W=new SuperMap.Geometry.Point(s.x-u.x,s.y-u.y);var O=new SuperMap.Geometry.Point(r.x-s.x,r.y-s.y);var U=this.calculateVector(W,Math.PI/2,Q/2);var H=U[0];var ab=U[1];var L=this.calculateVector(O,Math.PI/2,Q/2);var y=L[0];var T=L[1];var K=new SuperMap.Geometry.Point(u.x+H.x,u.y+H.y);var ae=new SuperMap.Geometry.Point(u.x+ab.x,u.y+ab.y);var J=new SuperMap.Geometry.Point(s.x+y.x,s.y+y.y);var ad=new SuperMap.Geometry.Point(s.x+T.x,s.y+T.y);var S=this.calculateIntersection(W,O,K,J);var N=this.calculateIntersection(W,O,ae,ad);var P;var d;if(X==0){h=K;c=ae;P=new SuperMap.Geometry.Point((h.x+S.x)/2,(h.y+S.y)/2);d=new SuperMap.Geometry.Point((c.x+N.x)/2,(c.y+N.y)/2);C.push(P);z.push(d)}else{var I=C[C.length-1];var Z=z[z.length-1];P=new SuperMap.Geometry.Point((I.x+S.x)/2,(I.y+S.y)/2);d=new SuperMap.Geometry.Point((Z.x+N.x)/2,(Z.y+N.y)/2);C.push(P);z.push(d)}C.push(S);z.push(N)}var D=R[R.length-2];var F=R[R.length-1];var G=new SuperMap.Geometry.Point(F.x-D.x,F.y-D.y);var o=Math.sqrt(G.x*G.x+G.y*G.y);var B;var x;var aa=[];var g=SuperMap.Geometry.Point();var v=SuperMap.Geometry.Point();var M=SuperMap.Geometry.Point();var b=SuperMap.Geometry.Point();var t=SuperMap.Geometry.Point();var q=SuperMap.Geometry.Point();var E=C[C.length-1];var a=z[z.length-1];if(o<=Q){aa=this.calculateVector(G,Math.PI/2,Q/2);g=aa[0];v=aa[1];B=new SuperMap.Geometry.Point(D.x+g.x,D.y+g.y);x=new SuperMap.Geometry.Point(D.x+v.x,D.y+v.y);M=new SuperMap.Geometry.Point((E.x+B.x)/2,(E.y+B.y)/2);b=new SuperMap.Geometry.Point((a.x+x.x)/2,(a.y+x.y)/2);C.push(M);z.push(b);t=new SuperMap.Geometry.Point(2*B.x-D.x,2*B.y-D.y);q=new SuperMap.Geometry.Point(2*x.x-D.x,2*x.y-D.y)}else{var ac=new SuperMap.Geometry.Point(F.x-D.x,F.y-D.y);var p=Math.sqrt(ac.x*ac.x+ac.y*ac.y);var A=new SuperMap.Geometry.Point(F.x-ac.x*Q/p,F.y-ac.y*Q/p);aa=this.calculateVector(G,Math.PI/2,Q/2);g=aa[0];v=aa[1];B=new SuperMap.Geometry.Point(A.x+g.x,A.y+g.y);x=new SuperMap.Geometry.Point(A.x+v.x,A.y+v.y);M=new SuperMap.Geometry.Point((E.x+B.x)/2,(E.y+B.y)/2);b=new SuperMap.Geometry.Point((a.x+x.x)/2,(a.y+x.y)/2);C.push(M);z.push(b);t=new SuperMap.Geometry.Point(2*B.x-A.x,2*B.y-A.y);q=new SuperMap.Geometry.Point(2*x.x-A.x,2*x.y-A.y)}var k=SuperMap.Geometry.LineString.createBezier2(C).components;var f=SuperMap.Geometry.LineString.createBezier2(z).components;var m=[h];m=m.concat(k);m.push(B);m.push(t);m.push(F);m.push(q);m.push(x);m=m.concat(f.reverse());m.push(c);this.components.push(new SuperMap.Geometry.LinearRing(m))},CLASS_NAME:"SuperMap.Geometry.GeoStraightArrow"});SuperMap.Geometry.GeoStraightArrow.fromJSON=function(e){var d=new SuperMap.Geometry.GeoStraightArrow();var c=e.match(/"ratio":([0-9]+)/)[1];d._ratio=parseInt(c);var b=e.match(/"controlPoints":(\[.*?\])/)[1];var a=SuperMap.Geometry.GeoPlotting.getControlPointsFromJSON(b);d._controlPoints=a;return d};SuperMap.Geometry.GeoDoveTailStraightArrow=SuperMap.Class(SuperMap.Geometry.GeoPlotting,{_ratio:6,_tailRatio:5,initialize:function(a){SuperMap.Geometry.GeoPlotting.prototype.initialize.apply(this,arguments)},getRatio:function(){return this._ratio},setRatio:function(a){if(a){this._ratio=a;this.calculateParts()}},clone:function(){var c=new SuperMap.Geometry.GeoDoveTailStraightArrow();var b=[];for(var d=0,a=this._controlPoints.length;d<a;d++){b.push(this._controlPoints[d].clone())}c._ratio=this._ratio;c._controlPoints=b;return c},toJSON:function(){if(!this._controlPoints){return null}var c;var b=this._controlPoints.length;var a=[];for(var d=0;d<b;d++){a.push(this.controlPointToJSON(this._controlPoints[d]))}c='{"controlPoints":['+a.join(",")+'],"ratio":'+this._ratio+"}";return c},calculateParts:function(){if(this._controlPoints==null||this._controlPoints.length<2){return}if(this._controlPoints.length==2&&(this._controlPoints[0]).equals(this._controlPoints[1])){return}this.components=[];if(this._controlPoints.length==2){this.calculateTwoPoints()}else{this.calculateMorePoints()}},calculateTwoPoints:function(){var m=this.cloneControlPoints(this._controlPoints);var n=m[0];var r=m[1];var q=Math.sqrt((r.y-n.y)*(r.y-n.y)+(r.x-n.x)*(r.x-n.x));var o=q/this._ratio;var s=n.x+(r.x-n.x)*(this._ratio-1)/this._ratio;var g=n.y+(r.y-n.y)*(this._ratio-1)/this._ratio;var p=this.calculateVector(new SuperMap.Geometry.Point(r.x-n.x,r.y-n.y),Math.PI/2,o/2);var k=p[0];var i=p[1];var h=new SuperMap.Geometry.Point(n.x+k.x,n.y+k.y);var f=new SuperMap.Geometry.Point(s+h.x-n.x,g+h.y-n.y);var e=new SuperMap.Geometry.Point(2*f.x-s,2*f.y-g);var d=new SuperMap.Geometry.Point(r.x,r.y);var a=new SuperMap.Geometry.Point(n.x+i.x,n.y+i.y);var b=new SuperMap.Geometry.Point(s+a.x-n.x,g+a.y-n.y);var c=new SuperMap.Geometry.Point(2*b.x-s,2*b.y-g);var j=new SuperMap.Geometry.Point((r.x-n.x)/this._tailRatio+n.x,(r.y-n.y)/this._tailRatio+n.y);this.components.push(new SuperMap.Geometry.LinearRing([j,h,f,e,d,c,b,a]))},calculateMorePoints:function(){var R=this.cloneControlPoints(this._controlPoints);var V=0;var Q=0;var Z;for(var Y=0;Y<R.length-1;Y++){var e=R[Y];var n=R[Y+1];V+=Math.sqrt((n.y-e.y)*(n.y-e.y)+(n.x-e.x)*(n.x-e.x));if(Y==0){Z=new SuperMap.Geometry.Point((n.x-e.x)/this._tailRatio+e.x,(n.y-e.y)/this._tailRatio+e.y)}}Q=V/this._ratio;var C=[];var z=[];var h=SuperMap.Geometry.Point();var c=SuperMap.Geometry.Point();for(var X=0;X<R.length-2;X++){var u=R[X];var s=R[X+1];var r=R[X+2];var W=new SuperMap.Geometry.Point(s.x-u.x,s.y-u.y);var O=new SuperMap.Geometry.Point(r.x-s.x,r.y-s.y);var U=this.calculateVector(W,Math.PI/2,Q/2);var H=U[0];var ac=U[1];var L=this.calculateVector(O,Math.PI/2,Q/2);var y=L[0];var T=L[1];var K=new SuperMap.Geometry.Point(u.x+H.x,u.y+H.y);var af=new SuperMap.Geometry.Point(u.x+ac.x,u.y+ac.y);var J=new SuperMap.Geometry.Point(s.x+y.x,s.y+y.y);var ae=new SuperMap.Geometry.Point(s.x+T.x,s.y+T.y);var S=this.calculateIntersection(W,O,K,J);var N=this.calculateIntersection(W,O,af,ae);var P;var d;if(X==0){h=K;c=af;P=new SuperMap.Geometry.Point((h.x+S.x)/2,(h.y+S.y)/2);d=new SuperMap.Geometry.Point((c.x+N.x)/2,(c.y+N.y)/2);C.push(P);z.push(d)}else{var I=C[C.length-1];var aa=z[z.length-1];P=new SuperMap.Geometry.Point((I.x+S.x)/2,(I.y+S.y)/2);d=new SuperMap.Geometry.Point((aa.x+N.x)/2,(aa.y+N.y)/2);C.push(P);z.push(d)}C.push(S);z.push(N)}var D=R[R.length-2];var F=R[R.length-1];var G=new SuperMap.Geometry.Point(F.x-D.x,F.y-D.y);var o=Math.sqrt(G.x*G.x+G.y*G.y);var B;var x;var ab=[];var g=SuperMap.Geometry.Point();var v=SuperMap.Geometry.Point();var M=SuperMap.Geometry.Point();var b=SuperMap.Geometry.Point();var t=SuperMap.Geometry.Point();var q=SuperMap.Geometry.Point();var E=C[C.length-1];var a=z[z.length-1];if(o<=Q){ab=this.calculateVector(G,Math.PI/2,Q/2);g=ab[0];v=ab[1];B=new SuperMap.Geometry.Point(D.x+g.x,D.y+g.y);x=new SuperMap.Geometry.Point(D.x+v.x,D.y+v.y);M=new SuperMap.Geometry.Point((E.x+B.x)/2,(E.y+B.y)/2);b=new SuperMap.Geometry.Point((a.x+x.x)/2,(a.y+x.y)/2);C.push(M);z.push(b);t=new SuperMap.Geometry.Point(2*B.x-D.x,2*B.y-D.y);q=new SuperMap.Geometry.Point(2*x.x-D.x,2*x.y-D.y)}else{var ad=new SuperMap.Geometry.Point(F.x-D.x,F.y-D.y);var p=Math.sqrt(ad.x*ad.x+ad.y*ad.y);var A=new SuperMap.Geometry.Point(F.x-ad.x*Q/p,F.y-ad.y*Q/p);ab=this.calculateVector(G,Math.PI/2,Q/2);g=ab[0];v=ab[1];B=new SuperMap.Geometry.Point(A.x+g.x,A.y+g.y);x=new SuperMap.Geometry.Point(A.x+v.x,A.y+v.y);M=new SuperMap.Geometry.Point((E.x+B.x)/2,(E.y+B.y)/2);b=new SuperMap.Geometry.Point((a.x+x.x)/2,(a.y+x.y)/2);C.push(M);z.push(b);t=new SuperMap.Geometry.Point(2*B.x-A.x,2*B.y-A.y);q=new SuperMap.Geometry.Point(2*x.x-A.x,2*x.y-A.y)}var k=SuperMap.Geometry.LineString.createBezier2(C).components;var f=SuperMap.Geometry.LineString.createBezier2(z).components;var m=[h];m=m.concat(k);m.push(B);m.push(t);m.push(F);m.push(q);m.push(x);m=m.concat(f.reverse());m.push(c);m.push(Z);this.components.push(new SuperMap.Geometry.LinearRing(m))},CLASS_NAME:"SuperMap.Geometry.GeoDoveTailStraightArrow"});SuperMap.Geometry.GeoDoveTailStraightArrow.fromJSON=function(e){var b=new SuperMap.Geometry.GeoDoveTailStraightArrow();var d=e.match(/"ratio":([0-9]+)/)[1];b._ratio=parseInt(d);var c=e.match(/"controlPoints":(\[.*?\])/)[1];var a=SuperMap.Geometry.GeoPlotting.getControlPointsFromJSON(c);b._controlPoints=a;return b};SuperMap.Geometry.GeoTriangleFlag=SuperMap.Class(SuperMap.Geometry.GeoPlotting,{initialize:function(a){SuperMap.Geometry.GeoPlotting.prototype.initialize.apply(this,arguments)},toJSON:function(){return SuperMap.Geometry.GeoPlotting.prototype.toJSON.apply(this,arguments)},clone:function(){var d=new SuperMap.Geometry.GeoTriangleFlag();var b=[];for(var c=0,a=this._controlPoints.length;c<a;c++){b.push(this._controlPoints[c].clone())}d._controlPoints=b;return d},calculateParts:function(){this.components=[];if(this._controlPoints.length>1){var f=this._controlPoints[0];var d=this._controlPoints[this._controlPoints.length-1];var e=f.clone();var c=new SuperMap.Geometry.Point(d.x,(f.y+d.y)/2);var b=new SuperMap.Geometry.Point(f.x,(f.y+d.y)/2);var a=new SuperMap.Geometry.Point(f.x,d.y);this.components.push(new SuperMap.Geometry.LinearRing([e,c,b,a]))}},CLASS_NAME:"SuperMap.Geometry.GeoTriangleFlag"});SuperMap.Geometry.GeoTriangleFlag.fromJSON=function(d){var c=new SuperMap.Geometry.GeoTriangleFlag();var b=d.match(/"controlPoints":(\[.*?\])/)[1];var a=SuperMap.Geometry.GeoPlotting.getControlPointsFromJSON(b);c._controlPoints=a;return c};SuperMap.Handler.Plotting=SuperMap.Class(SuperMap.Handler,{controlPoints:[],plotting:null,isDrawing:false,layerOptions:null,pixelTolerance:5,point:null,layer:null,multi:false,mouseDown:false,stoppedDown:null,lastDown:null,lastUp:null,persist:false,stopDown:false,stopUp:false,touch:false,lastTouchPx:null,initialize:function(c,b,a){if(!(a&&a.layerOptions&&a.layerOptions.styleMap)){this.style=SuperMap.Util.extend(SuperMap.Feature.Vector.style["default"],{})}SuperMap.Handler.prototype.initialize.apply(this,arguments)},activate:function(){if(!SuperMap.Handler.prototype.activate.apply(this,arguments)){return false}this.controlPoints=[];this.plotting=null;this.isDrawing=false;var a=SuperMap.Util.extend({displayInLayerSwitcher:false,calculateInRange:SuperMap.Function.True},this.layerOptions);this.layer=new SuperMap.Layer.Vector(this.CLASS_NAME,a);this.map.addLayer(this.layer);SuperMap.Element.addClass(this.map.viewPortDiv,"smDefault");return true},deactivate:function(){if(!SuperMap.Handler.prototype.deactivate.apply(this,arguments)){return false}this.controlPoints=[];this.plotting=null;this.isDrawing=false;this.cancel();if(this.layer.map!=null){SuperMap.Element.removeClass(this.map.viewPortDiv,"smDefault");this.destroyFeature(true);this.layer.destroy(false)}this.layer=null;this.touch=false;return true},createFeature:function(a){},modifyFeature:function(a){if(this.lastUp&&this.lastUp.equals(a)){return true}if(!this.point||!this.plotting){this.createFeature(a)}var b=this.layer.getLonLatFromViewPortPx(a);this.point.geometry.x=b.lon;this.point.geometry.y=b.lat;if(this.isDrawing==true){var d=new SuperMap.Geometry.Point(b.lon,b.lat);var c=this.controlPoints.concat([d]);this.plotting.geometry._controlPoints=this.cloneControlPoints(c);this.plotting.geometry.calculateParts()}this.callback("modify",[this.point.geometry,this.getSketch(),false]);this.point.geometry.clearBounds();this.drawFeature()},up:function(a){},down:function(a){this.mouseDown=true;this.lastDown=a.xy;if(!this.touch){this.modifyFeature(a.xy)}this.stoppedDown=this.stopDown;return !this.stopDown},move:function(a){if(!this.touch&&(!this.mouseDown||this.stoppedDown)){this.modifyFeature(a.xy)}return true},click:function(a){SuperMap.Event.stop(a);return false},dblclick:function(a){SuperMap.Event.stop(a);return false},destroyPersistedFeature:function(){var a=this.layer;if(a&&a.features.length>1){this.layer.features[0].destroy()}},addControlPoint:function(a){var b=this.layer.getLonLatFromViewPortPx(a);var c=new SuperMap.Geometry.Point(b.lon,b.lat);this.controlPoints.push(c)},drawFeature:function(){this.layer.renderer.clear();this.layer.drawFeature(this.plotting,this.style);this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.plotting},destroyFeature:function(a){if(this.layer&&(a||!this.persist)){this.layer.destroyFeatures()}this.point=null;this.plotting=null},finalize:function(b){var a=b?"cancel":"done";this.mouseDown=false;this.lastDown=null;this.lastUp=null;this.lastTouchPx=null;this.callback(a,[this.geometryClone()]);this.destroyFeature(b)},cancel:function(){this.finalize(true)},getGeometry:function(){if(this.plotting&&this.plotting.geometry){return this.plotting.geometry}},geometryClone:function(){var a=this.getGeometry();if(a&&a._controlPoints){var b=a.clone();b.calculateParts();return b}},mousedown:function(a){return this.down(a)},touchstart:function(a){if(!this.touch){this.touch=true;this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this})}this.lastTouchPx=a.xy;return this.down(a)},mousemove:function(a){return this.move(a)},touchmove:function(a){this.lastTouchPx=a.xy;return this.move(a)},mouseup:function(a){return this.up(a)},touchend:function(a){a.xy=this.lastTouchPx;return this.up(a)},mouseout:function(a){if(SuperMap.Util.mouseLeft(a,this.map.eventsDiv)){this.stoppedDown=this.stopDown;this.mouseDown=false}},passesTolerance:function(e,d,a){var b=true;if(a!=null&&e&&d){var c=e.distanceTo(d);if(c>a){b=false}}return b},cloneControlPoints:function(c){var a=[];for(var b=0;b<c.length;b++){a.push(c[b].clone())}return a},drawComplete:function(){this.finalize();this.isDrawing=false;this.controlPoints=[];if(this.active==true){this.layer.removeAllFeatures()}},CLASS_NAME:"SuperMap.Handler.Plotting"});SuperMap.Handler.CircleEx=SuperMap.Class(SuperMap.Handler.Plotting,{initialize:function(c,b,a){SuperMap.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(a){var b=this.layer.getLonLatFromViewPortPx(a);var c=new SuperMap.Geometry.Point(b.lon,b.lat);this.point=new SuperMap.Feature.Vector(c);this.plotting=new SuperMap.Feature.Vector(new SuperMap.Geometry.GeoCircle());this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds()},destroyPersistedFeature:function(){var a=this.layer;if(a&&a.features.length>2){this.layer.features[0].destroy()}},up:function(b){this.mouseDown=false;this.stoppedDown=this.stopDown;if(this.lastUp&&this.lastUp.equals(b.xy)){return true}if(this.lastDown&&this.passesTolerance(this.lastDown,b.xy,this.pixelTolerance)){if(this.touch){this.modifyFeature(b.xy)}if(this.persist){this.destroyPersistedFeature()}this.lastUp=b.xy;this.addControlPoint(b.xy);var a=this.controlPoints.length;if(a==1){this.isDrawing=true}else{if(a==2){this.drawComplete()}}return true}else{return true}},CLASS_NAME:"SuperMap.Handler.CircleEx"});SuperMap.Handler.CurveFlag=SuperMap.Class(SuperMap.Handler.Plotting,{initialize:function(c,b,a){SuperMap.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(a){var b=this.layer.getLonLatFromViewPortPx(a);var c=new SuperMap.Geometry.Point(b.lon,b.lat);this.point=new SuperMap.Feature.Vector(c);this.plotting=new SuperMap.Feature.Vector(new SuperMap.Geometry.GeoCurveFlag());this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds()},destroyPersistedFeature:function(){var a=this.layer;if(a&&a.features.length>2){this.layer.features[0].destroy()}},up:function(b){this.mouseDown=false;this.stoppedDown=this.stopDown;if(this.lastUp&&this.lastUp.equals(b.xy)){return true}if(this.lastDown&&this.passesTolerance(this.lastDown,b.xy,this.pixelTolerance)){if(this.touch){this.modifyFeature(b.xy)}if(this.persist){this.destroyPersistedFeature()}this.lastUp=b.xy;this.addControlPoint(b.xy);var a=this.controlPoints.length;if(a==1){this.isDrawing=true}else{if(a==2){this.drawComplete()}else{this.isDrawing=false;this.controlPoints=[];this.plotting=null}}return true}else{return true}},CLASS_NAME:"SuperMap.Handler.CurveFlag"});SuperMap.Handler.DiagonalArrow=SuperMap.Class(SuperMap.Handler.Plotting,{initialize:function(c,b,a){SuperMap.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(a){var b=this.layer.getLonLatFromViewPortPx(a);var c=new SuperMap.Geometry.Point(b.lon,b.lat);this.point=new SuperMap.Feature.Vector(c);this.plotting=new SuperMap.Feature.Vector(new SuperMap.Geometry.GeoDiagonalArrow());this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds()},destroyPersistedFeature:function(){var a=this.layer;if(a&&a.features.length>2){this.layer.features[0].destroy()}},down:function(a){this.mouseDown=true;this.lastDown=a.xy;if(this.touch){this.modifyFeature(a.xy);SuperMap.Event.stop(a)}this.stoppedDown=this.stopDown;return !this.stopDown},up:function(b){this.mouseDown=false;this.stoppedDown=this.stopDown;if(this.lastUp&&this.lastUp.equals(b.xy)){return true}if(this.lastDown&&this.passesTolerance(this.lastDown,b.xy,this.pixelTolerance)){if(this.touch){this.modifyFeature(b.xy)}if(this.persist){this.destroyPersistedFeature()}this.lastUp=b.xy;this.addControlPoint(b.xy);var a=this.controlPoints.length;if(a==1){this.isDrawing=true}return true}else{return true}},dblclick:function(a){this.drawComplete();return false},CLASS_NAME:"SuperMap.Handler.DiagonalArrow"});SuperMap.Handler.DoveTailDiagonalArrow=SuperMap.Class(SuperMap.Handler.Plotting,{initialize:function(c,b,a){SuperMap.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(a){var b=this.layer.getLonLatFromViewPortPx(a);var c=new SuperMap.Geometry.Point(b.lon,b.lat);this.point=new SuperMap.Feature.Vector(c);this.plotting=new SuperMap.Feature.Vector(new SuperMap.Geometry.GeoDoveTailDiagonalArrow());this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds()},destroyPersistedFeature:function(){var a=this.layer;if(a&&a.features.length>2){this.layer.features[0].destroy()}},down:function(a){this.mouseDown=true;this.lastDown=a.xy;if(this.touch){this.modifyFeature(a.xy);SuperMap.Event.stop(a)}this.stoppedDown=this.stopDown;return !this.stopDown},up:function(b){this.mouseDown=false;this.stoppedDown=this.stopDown;if(this.lastUp&&this.lastUp.equals(b.xy)){return true}if(this.lastDown&&this.passesTolerance(this.lastDown,b.xy,this.pixelTolerance)){if(this.touch){this.modifyFeature(b.xy)}if(this.persist){this.destroyPersistedFeature()}this.lastUp=b.xy;this.addControlPoint(b.xy);var a=this.controlPoints.length;if(a==1){this.isDrawing=true}return true}else{return true}},dblclick:function(a){this.drawComplete();return false},CLASS_NAME:"SuperMap.Handler.DoveTailDiagonalArrow"});SuperMap.Handler.DoubleArrow=SuperMap.Class(SuperMap.Handler.Plotting,{initialize:function(c,b,a){SuperMap.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(a){var b=this.layer.getLonLatFromViewPortPx(a);var c=new SuperMap.Geometry.Point(b.lon,b.lat);this.point=new SuperMap.Feature.Vector(c);this.plotting=new SuperMap.Feature.Vector(new SuperMap.Geometry.GeoDoubleArrow());this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds()},destroyPersistedFeature:function(){var a=this.layer;if(a&&a.features.length>2){this.layer.features[0].destroy()}},modifyFeature:function(e){if(this.lastUp&&this.lastUp.equals(e)){return true}if(!this.point||!this.plotting){this.createFeature(e)}var f=this.layer.getLonLatFromViewPortPx(e);this.point.geometry.x=f.lon;this.point.geometry.y=f.lat;if(this.isDrawing==true){var h=new SuperMap.Geometry.Point(f.lon,f.lat);var b=this.controlPoints.length;if(b==2){var c=this.controlPoints[1].x-this.controlPoints[0].x;var a=this.controlPoints[1].y-this.controlPoints[0].y;var d=new SuperMap.Geometry.Point((f.lon-c),(f.lat-a));var g=this.controlPoints.concat([h,d])}else{if(b==3){var g=this.controlPoints.concat([h])}}this.plotting.geometry._controlPoints=this.cloneControlPoints(g);this.plotting.geometry.calculateParts()}this.callback("modify",[this.point.geometry,this.getSketch(),false]);this.point.geometry.clearBounds();this.drawFeature()},up:function(b){this.mouseDown=false;this.stoppedDown=this.stopDown;if(this.lastUp&&this.lastUp.equals(b.xy)){return true}if(this.lastDown&&this.passesTolerance(this.lastDown,b.xy,this.pixelTolerance)){if(this.touch){this.modifyFeature(b.xy)}if(this.persist){this.destroyPersistedFeature()}this.lastUp=b.xy;this.addControlPoint(b.xy);var a=this.controlPoints.length;if(a==1){}else{if(a==2||a==3){this.isDrawing=true}else{if(a==4){this.drawComplete()}else{this.isDrawing=false;this.controlPoints=[];this.plotting=null}}}return true}else{return true}},CLASS_NAME:"SuperMap.Handler.DoubleArrow"});SuperMap.Handler.RectFlag=SuperMap.Class(SuperMap.Handler.Plotting,{initialize:function(c,b,a){SuperMap.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(a){var b=this.layer.getLonLatFromViewPortPx(a);var c=new SuperMap.Geometry.Point(b.lon,b.lat);this.point=new SuperMap.Feature.Vector(c);this.plotting=new SuperMap.Feature.Vector(new SuperMap.Geometry.GeoRectFlag());this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds()},destroyPersistedFeature:function(){var a=this.layer;if(a&&a.features.length>2){this.layer.features[0].destroy()}},up:function(b){this.mouseDown=false;this.stoppedDown=this.stopDown;if(this.lastUp&&this.lastUp.equals(b.xy)){return true}if(this.lastDown&&this.passesTolerance(this.lastDown,b.xy,this.pixelTolerance)){if(this.touch){this.modifyFeature(b.xy)}if(this.persist){this.destroyPersistedFeature()}this.lastUp=b.xy;this.addControlPoint(b.xy);var a=this.controlPoints.length;if(a==1){this.isDrawing=true}else{if(a==2){this.drawComplete()}else{this.isDrawing=false;this.controlPoints=[];this.plotting=null}}return true}else{return true}},CLASS_NAME:"SuperMap.Handler.RectFlag"});SuperMap.Handler.StraightArrow=SuperMap.Class(SuperMap.Handler.Plotting,{initialize:function(c,b,a){SuperMap.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(a){var b=this.layer.getLonLatFromViewPortPx(a);var c=new SuperMap.Geometry.Point(b.lon,b.lat);this.point=new SuperMap.Feature.Vector(c);this.plotting=new SuperMap.Feature.Vector(new SuperMap.Geometry.GeoStraightArrow());this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds()},destroyPersistedFeature:function(){var a=this.layer;if(a&&a.features.length>2){this.layer.features[0].destroy()}},down:function(a){this.mouseDown=true;this.lastDown=a.xy;if(this.touch){this.modifyFeature(a.xy);SuperMap.Event.stop(a)}this.stoppedDown=this.stopDown;return !this.stopDown},up:function(b){this.mouseDown=false;this.stoppedDown=this.stopDown;if(this.lastUp&&this.lastUp.equals(b.xy)){return true}if(this.lastDown&&this.passesTolerance(this.lastDown,b.xy,this.pixelTolerance)){if(this.touch){this.modifyFeature(b.xy)}if(this.persist){this.destroyPersistedFeature()}this.lastUp=b.xy;this.addControlPoint(b.xy);var a=this.controlPoints.length;if(a==1){this.isDrawing=true}return true}else{return true}},dblclick:function(a){this.drawComplete();return false},CLASS_NAME:"SuperMap.Handler.StraightArrow"});SuperMap.Handler.DoveTailStraightArrow=SuperMap.Class(SuperMap.Handler.Plotting,{initialize:function(c,b,a){SuperMap.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(a){var b=this.layer.getLonLatFromViewPortPx(a);var c=new SuperMap.Geometry.Point(b.lon,b.lat);this.point=new SuperMap.Feature.Vector(c);this.plotting=new SuperMap.Feature.Vector(new SuperMap.Geometry.GeoDoveTailStraightArrow());this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds()},destroyPersistedFeature:function(){var a=this.layer;if(a&&a.features.length>2){this.layer.features[0].destroy()}},down:function(a){this.mouseDown=true;this.lastDown=a.xy;if(this.touch){this.modifyFeature(a.xy);SuperMap.Event.stop(a)}this.stoppedDown=this.stopDown;return !this.stopDown},up:function(b){this.mouseDown=false;this.stoppedDown=this.stopDown;if(this.lastUp&&this.lastUp.equals(b.xy)){return true}if(this.lastDown&&this.passesTolerance(this.lastDown,b.xy,this.pixelTolerance)){if(this.touch){this.modifyFeature(b.xy)}if(this.persist){this.destroyPersistedFeature()}this.lastUp=b.xy;this.addControlPoint(b.xy);var a=this.controlPoints.length;if(a==1){this.isDrawing=true}return true}else{return true}},dblclick:function(a){this.drawComplete();return false},CLASS_NAME:"SuperMap.Handler.DoveTailStraightArrow"});SuperMap.Handler.TriangleFlag=SuperMap.Class(SuperMap.Handler.Plotting,{initialize:function(c,b,a){SuperMap.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(a){var b=this.layer.getLonLatFromViewPortPx(a);var c=new SuperMap.Geometry.Point(b.lon,b.lat);this.point=new SuperMap.Feature.Vector(c);this.plotting=new SuperMap.Feature.Vector(new SuperMap.Geometry.GeoTriangleFlag());this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds()},destroyPersistedFeature:function(){var a=this.layer;if(a&&a.features.length>2){this.layer.features[0].destroy()}},up:function(b){this.mouseDown=false;this.stoppedDown=this.stopDown;if(this.lastUp&&this.lastUp.equals(b.xy)){return true}if(this.lastDown&&this.passesTolerance(this.lastDown,b.xy,this.pixelTolerance)){if(this.touch){this.modifyFeature(b.xy)}if(this.persist){this.destroyPersistedFeature()}this.lastUp=b.xy;this.addControlPoint(b.xy);var a=this.controlPoints.length;if(a==1){this.isDrawing=true}else{if(a==2){this.drawComplete()}else{this.isDrawing=false;this.controlPoints=[];this.plotting=null}}return true}else{return true}},CLASS_NAME:"SuperMap.Handler.TriangleFlag"});SuperMap.Control.PlottingEdit=SuperMap.Class(SuperMap.Control,{EVENT_TYPES:["beforefeaturemodified","featuremodified","afterfeaturemodified"],clickout:true,controlPointsStyle:null,defaultStyle:{fillColor:"#ee9900",fillOpacity:0.4,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,pointRadius:6},controlPoints:[],layer:null,feature:null,selectControl:null,dragControl:null,modified:false,initialize:function(d,c){c=c||{};this.layer=d;this.controlPoints=[];SuperMap.Control.prototype.initialize.apply(this,[c]);var e=this;var a={clickout:this.clickout,toggle:false,onBeforeSelect:this.beforeSelectFeature,onSelect:this.selectFeature,onUnselect:this.unselectFeature,scope:this};this.selectControl=new SuperMap.Control.SelectFeature(d,a);var b={onStart:function(g,f){e.dragStart.apply(e,[g,f])},onDrag:function(g,f){e.dragControlPoint.apply(e,[g,f])},onComplete:function(f){e.dragComplete.apply(e,[f])},featureCallbacks:{over:function(f){e.dragControl.overFeature.apply(e.dragControl,[f])}}};this.dragControl=new SuperMap.Control.DragFeature(d,b)},destroy:function(){this.controlPoints=[];this.layer=null;this.selectControl.destroy();this.dragControl.destroy();SuperMap.Control.prototype.destroy.apply(this,[])},activate:function(){return(this.selectControl.activate()&&SuperMap.Control.prototype.activate.apply(this,arguments))},deactivate:function(){var c=false;if(SuperMap.Control.prototype.deactivate.apply(this,arguments)){this.layer.removeFeatures(this.controlPoints,{silent:true});this.controlPoints=[];this.dragControl.deactivate();var a=this.feature;var b=a&&a.geometry&&a.layer;if(b){this.selectControl.unselect.apply(this.selectControl,[a])}this.selectControl.deactivate();c=true}return c},deleteSymbol:function(){if(this.feature&&this.controlPoints&&this.controlPoints.length>0){this.layer.destroyFeatures(this.feature);this.layer.destroyFeatures(this.controlPoints);this.unselectFeature(this.feature);return true}else{return false}},selectFeature:function(a){if(this.beforeSelectFeature(a)!==false){if(a.geometry instanceof SuperMap.Geometry.GeoPlotting){this.feature=a;this.modified=false;this.resetControlPoints();this.dragControl.activate()}}},unselectFeature:function(a){this.layer.removeFeatures(this.controlPoints,{silent:true});this.controlPoints=[];this.feature=null;this.dragControl.deactivate();this.layer.events.triggerEvent("afterfeaturemodified",{feature:a,modified:this.modified});this.modified=false},beforeSelectFeature:function(a){return this.layer.events.triggerEvent("beforefeaturemodified",{feature:a})},dragStart:function(b,a){if(b!=this.feature&&b.geometry instanceof SuperMap.Geometry.GeoPlotting&&this.feature.geometry instanceof SuperMap.Geometry.GeoPlotting){if(this.feature){this.selectControl.clickFeature.apply(this.selectControl,[this.feature])}this.selectControl.clickFeature.apply(this.selectControl,[b]);this.dragControl.overFeature.apply(this.dragControl,[b]);this.dragControl.lastPixel=a;this.dragControl.handlers.drag.started=true;this.dragControl.handlers.drag.start=a;this.dragControl.handlers.drag.last=a}this._dragPixel=a;SuperMap.Element.removeClass(this.map.viewPortDiv,"smDragDown");this.map.viewPortDiv.style.cursor="pointer"},dragControlPoint:function(g,c){if(g.geometry.CLASS_NAME=="SuperMap.Geometry.Point"){this.modified=true;var f=this.feature.geometry;f._controlPoints=this.getCpGeos();f.calculateParts();this.layer.drawFeature(this.feature);this.layer.drawFeature(g)}else{if(g.geometry instanceof SuperMap.Geometry.GeoPlotting){this.modified=true;this.layer.removeFeatures(this.controlPoints,{silent:true});var b=this.layer.getLonLatFromViewPortPx(c);var e=this.layer.getLonLatFromViewPortPx(this._dragPixel);var h=this.getCpGeos();for(var d=0,a=h.length;d<a;d++){var g=h[d];g.x+=b.lon-e.lon;g.y+=b.lat-e.lat}var f=this.feature.geometry;f._controlPoints=h;this._dragPixel=c}}},dragComplete:function(){delete this._dragPixel;this.resetControlPoints();this.setFeatureState();this.layer.events.triggerEvent("featuremodified",{feature:this.feature})},setFeatureState:function(){if(this.feature.state!=SuperMap.State.INSERT&&this.feature.state!=SuperMap.State.DELETE){this.feature.state=SuperMap.State.UPDATE}},resetControlPoints:function(){if(this.controlPoints.length>0){this.layer.removeFeatures(this.controlPoints,{silent:true});this.controlPoints=[]}this.collectControlPoints()},collectControlPoints:function(){if(!this.feature||!this.feature.geometry){return}this.controlPoints=[];var b=this;function a(f){var d,g,e;if(f instanceof SuperMap.Geometry.GeoPlotting){var c=f._controlPoints.length;for(d=0;d<c;++d){e=f._controlPoints[d];if(e.CLASS_NAME=="SuperMap.Geometry.Point"){g=new SuperMap.Feature.Vector(e);g._sketch=true;g.style=SuperMap.Util.copyAttributes(g.style,b.defaultStyle);if(b.controlPointsStyle){g.style=SuperMap.Util.copyAttributes(g.style,b.controlPointsStyle)}b.controlPoints.push(g)}}}}a.call(this,this.feature.geometry);this.layer.addFeatures(this.controlPoints,{silent:true})},setMap:function(a){this.selectControl.setMap(a);this.dragControl.setMap(a);SuperMap.Control.prototype.setMap.apply(this,arguments)},getCpGeos:function(){var b=this.controlPoints;var c=[];for(var a=0;a<b.length;a++){c.push(b[a].geometry)}return c},cloneControlPoints:function(c){var a=[];for(var b=0;b<c.length;b++){a.push(c[b].clone())}return a},controlPointsToJSON:function(){if(this.feature&&this.feature.geometry&&this.feature.geometry instanceof SuperMap.Geometry.GeoPlotting){return this.feature.geometry.toJSON()}},CLASS_NAME:"SuperMap.Control.PlottingEdit"});